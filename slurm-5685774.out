Config file: ./configs/grpo_config.yaml
Epochs: 3
Data path: /fs/nexus-projects/figure-agent/Custom_Qwen3_Finetuning/data/chartcoder-16k
Output dir: /fs/nexus-projects/figure-agent/Custom_Qwen3_Finetuning/output/Qwen3_VL-v1
/fs/nexus-scratch/armins/miniconda3/envs/grpo/lib/python3.10/site-packages/transformers/utils/hub.py:110: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
Skipping import of cpp extensions due to incompatible torch version 2.8.0+cu128 for torchao version 0.14.1             Please see https://github.com/pytorch/ao/issues/2919 for more info
INFO 11-03 09:57:54 [__init__.py:216] Automatically detected platform cuda.
2025-11-03 09:57:56,636 - __main__ - INFO - Loading configuration from ./configs/grpo_config.yaml
2025-11-03 09:57:56,638 - __main__ - INFO - Setting up model...
2025-11-03 09:57:56,638 - src.grpo_trainer - INFO - Loading model: Qwen/Qwen3-VL-8B-Instruct
2025-11-03 09:57:57,849 - accelerate.utils.modeling - INFO - We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
Number of GPUs available: 1
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:00<00:02,  1.19it/s]Loading checkpoint shards:  50%|█████     | 2/4 [00:01<00:01,  1.14it/s]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:02<00:00,  1.15it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.33it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.26it/s]
2025-11-03 09:58:02,563 - src.grpo_trainer - INFO - Model setup completed
2025-11-03 09:58:02,563 - __main__ - INFO - Loading dataset from /fs/nexus-projects/figure-agent/Custom_Qwen3_Finetuning/data/chartcoder-16k
2025-11-03 09:58:02,809 - src.grpo_trainer - INFO - Loaded 12326 samples from /fs/nexus-projects/figure-agent/Custom_Qwen3_Finetuning/data/chartcoder-16k/prompts.json
trainable params: 43,646,976 || all params: 8,810,770,672 || trainable%: 0.4954
Map:   0%|          | 0/12326 [00:00<?, ? examples/s]Map:   1%|          | 137/12326 [00:00<00:09, 1350.99 examples/s]Map:   2%|▏         | 289/12326 [00:00<00:08, 1442.26 examples/s]Map:   4%|▎         | 437/12326 [00:00<00:08, 1457.17 examples/s]Map:   5%|▍         | 614/12326 [00:00<00:08, 1313.58 examples/s]Map:   6%|▌         | 752/12326 [00:00<00:08, 1329.83 examples/s]Map:   7%|▋         | 898/12326 [00:00<00:08, 1367.16 examples/s]Map:   8%|▊         | 1037/12326 [00:00<00:08, 1371.57 examples/s]Map:  10%|▉         | 1181/12326 [00:00<00:08, 1388.05 examples/s]Map:  11%|█         | 1376/12326 [00:01<00:08, 1346.09 examples/s]Map:  12%|█▏        | 1521/12326 [00:01<00:07, 1371.94 examples/s]Map:  14%|█▎        | 1665/12326 [00:01<00:07, 1386.37 examples/s]Map:  15%|█▍        | 1820/12326 [00:01<00:08, 1250.33 examples/s]Map:  16%|█▌        | 1965/12326 [00:01<00:07, 1300.25 examples/s]Map:  17%|█▋        | 2104/12326 [00:01<00:07, 1319.88 examples/s]Map:  18%|█▊        | 2267/12326 [00:01<00:08, 1230.73 examples/s]Map:  20%|█▉        | 2410/12326 [00:01<00:07, 1280.05 examples/s]Map:  21%|██        | 2585/12326 [00:01<00:07, 1235.09 examples/s]Map:  22%|██▏       | 2725/12326 [00:02<00:08, 1128.55 examples/s]Map:  23%|██▎       | 2870/12326 [00:02<00:07, 1205.70 examples/s]Map:  24%|██▍       | 3017/12326 [00:02<00:07, 1270.70 examples/s]Map:  26%|██▌       | 3170/12326 [00:02<00:06, 1337.54 examples/s]Map:  27%|██▋       | 3327/12326 [00:02<00:06, 1398.30 examples/s]Map:  29%|██▊       | 3535/12326 [00:02<00:06, 1389.31 examples/s]Map:  30%|██▉       | 3692/12326 [00:02<00:06, 1435.06 examples/s]Map:  32%|███▏      | 3914/12326 [00:02<00:05, 1444.96 examples/s]Map:  33%|███▎      | 4129/12326 [00:03<00:05, 1438.95 examples/s]Map:  35%|███▌      | 4334/12326 [00:03<00:05, 1410.58 examples/s]Map:  36%|███▋      | 4480/12326 [00:03<00:05, 1419.76 examples/s]Map:  38%|███▊      | 4678/12326 [00:03<00:05, 1384.92 examples/s]Map:  39%|███▉      | 4855/12326 [00:03<00:05, 1314.28 examples/s]Map:  41%|████      | 5000/12326 [00:03<00:05, 1337.08 examples/s]Map:  42%|████▏     | 5137/12326 [00:03<00:05, 1339.94 examples/s]Map:  43%|████▎     | 5293/12326 [00:03<00:05, 1395.80 examples/s]Map:  44%|████▍     | 5441/12326 [00:04<00:04, 1416.53 examples/s]Map:  45%|████▌     | 5593/12326 [00:04<00:04, 1440.48 examples/s]Map:  47%|████▋     | 5745/12326 [00:04<00:04, 1458.18 examples/s]Map:  48%|████▊     | 5965/12326 [00:04<00:04, 1458.48 examples/s]Map:  50%|████▉     | 6114/12326 [00:04<00:04, 1462.52 examples/s]Map:  51%|█████     | 6261/12326 [00:04<00:04, 1462.17 examples/s]Map:  52%|█████▏    | 6412/12326 [00:04<00:04, 1473.39 examples/s]Map:  53%|█████▎    | 6566/12326 [00:04<00:03, 1490.86 examples/s]Map:  55%|█████▍    | 6778/12326 [00:04<00:03, 1456.67 examples/s]Map:  56%|█████▌    | 6925/12326 [00:05<00:03, 1456.79 examples/s]Map:  57%|█████▋    | 7079/12326 [00:05<00:03, 1475.93 examples/s]Map:  59%|█████▊    | 7231/12326 [00:05<00:03, 1485.97 examples/s]Map:  60%|██████    | 7447/12326 [00:05<00:03, 1457.70 examples/s]Map:  62%|██████▏   | 7606/12326 [00:05<00:03, 1491.44 examples/s]Map:  63%|██████▎   | 7771/12326 [00:05<00:02, 1534.18 examples/s]Map:  64%|██████▍   | 7933/12326 [00:05<00:02, 1555.92 examples/s]Map:  66%|██████▋   | 8168/12326 [00:05<00:02, 1555.77 examples/s]Map:  68%|██████▊   | 8402/12326 [00:06<00:02, 1554.72 examples/s]Map:  70%|██████▉   | 8615/12326 [00:06<00:02, 1506.00 examples/s]Map:  71%|███████▏  | 8808/12326 [00:06<00:02, 1430.70 examples/s]Map:  73%|███████▎  | 9018/12326 [00:06<00:02, 1417.01 examples/s]Map:  74%|███████▍  | 9171/12326 [00:06<00:02, 1440.43 examples/s]Map:  76%|███████▌  | 9380/12326 [00:06<00:02, 1420.57 examples/s]Map:  77%|███████▋  | 9524/12326 [00:06<00:01, 1422.48 examples/s]Map:  78%|███████▊  | 9668/12326 [00:06<00:01, 1425.55 examples/s]Map:  80%|███████▉  | 9821/12326 [00:07<00:01, 1450.60 examples/s]Map:  81%|████████  | 9968/12326 [00:07<00:01, 1452.47 examples/s]Map:  82%|████████▏ | 10121/12326 [00:07<00:01, 1469.76 examples/s]Map:  84%|████████▍ | 10332/12326 [00:07<00:01, 1442.87 examples/s]Map:  85%|████████▌ | 10479/12326 [00:07<00:01, 1446.89 examples/s]Map:  86%|████████▌ | 10627/12326 [00:07<00:01, 1452.96 examples/s]Map:  87%|████████▋ | 10784/12326 [00:07<00:01, 1484.07 examples/s]Map:  89%|████████▊ | 10937/12326 [00:07<00:00, 1496.58 examples/s]Map:  90%|████████▉ | 11092/12326 [00:07<00:00, 1508.40 examples/s]Map:  92%|█████████▏| 11312/12326 [00:08<00:00, 1485.15 examples/s]Map:  93%|█████████▎| 11465/12326 [00:08<00:00, 1492.78 examples/s]Map:  94%|█████████▍| 11616/12326 [00:08<00:00, 1489.86 examples/s]Map:  95%|█████████▌| 11766/12326 [00:08<00:00, 1488.50 examples/s]Map:  97%|█████████▋| 11920/12326 [00:08<00:00, 1497.38 examples/s]Map:  98%|█████████▊| 12139/12326 [00:08<00:00, 1473.84 examples/s]Map: 100%|█████████▉| 12290/12326 [00:08<00:00, 1482.56 examples/s]Map: 100%|██████████| 12326/12326 [00:08<00:00, 1416.55 examples/s]
2025-11-03 09:58:11,757 - __main__ - INFO - Starting GRPO training...
2025-11-03 09:58:12,801 - accelerate.utils.other - WARNING - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
The model is already on multiple devices. Skipping the move to device specified in `args`.
2025-11-03 09:58:12,809 - src.grpo_trainer - INFO - Starting GRPO training for 3 epochs
The tokenizer has new PAD/BOS/EOS tokens that differ from the model config and generation config. The model config and generation config were aligned accordingly, being updated with the tokenizer's values. Updated tokens: {'eos_token_id': 151645, 'bos_token_id': None, 'pad_token_id': 151643}.
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/armins/.triton_cache, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
  0%|          | 0/8781 [00:00<?, ?it/s]`generation_config` default values have been modified to match model-specific defaults: {'temperature': 0.7, 'top_p': 0.8}. If this is not desired, please set these values explicitly.
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.52, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
2025-11-03 10:03:43,354 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:03:43,355 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:03:43,630 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:03:43,631 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:03:43,936 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:03:43,936 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:03:45,939 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:03:45,940 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:04:03,507 - src.grpo_trainer - INFO - Timing (avg over 1 steps) — gen: 329.135s, reward: 4.853s, non_gen: 21.295s, step: 350.430s
  0%|          | 1/8781 [05:50<854:39:58, 350.43s/it]2025-11-03 10:09:50,671 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:09:50,672 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:09:53,486 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:09:53,486 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:10:09,946 - src.grpo_trainer - INFO - Timing (avg over 2 steps) — gen: 337.653s, reward: 4.436s, non_gen: 20.738s, step: 358.390s
  0%|          | 2/8781 [11:56<877:31:46, 359.85s/it]2025-11-03 10:10:49,562 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:10:49,563 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:10:55,708 - src.grpo_trainer - INFO - Timing (avg over 3 steps) — gen: 238.043s, reward: 4.214s, non_gen: 16.137s, step: 254.180s
  0%|          | 3/8781 [12:42<527:43:42, 216.43s/it]2025-11-03 10:16:46,198 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:16:46,199 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:16:46,472 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:16:46,473 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:16:47,790 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:16:47,791 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:16:48,098 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:16:48,098 - matplotlib.category - INFO - Using categorical units to plot a list of strings that are all parsable as floats or dates. If these strings should be plotted as numbers, cast to the appropriate data type before plotting.
2025-11-03 10:17:05,048 - src.grpo_trainer - INFO - Timing (avg over 4 steps) — gen: 265.727s, reward: 4.254s, non_gen: 17.242s, step: 282.970s
  0%|          | 4/8781 [18:51<674:50:48, 276.80s/it]slurmstepd: error: *** JOB 5685774 ON cml35 CANCELLED AT 2025-11-03T10:21:24 ***
